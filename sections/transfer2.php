<?php
vtupress_auto_override();
$nomba = ["090645"=>"Nombank","120001"=>"9PSB","090270"=>"AB Microfinance Bank","418"=>"AG Mortgage Bank","090180"=>"AMJU Microfinance Bank","090001"=>"ASO Savings & Loans","070010"=>"Abbey Mortgage Bank","820"=>"Abucoop MFB","044"=>"Access Bank","100052"=>"Access Yellow","090134"=>"Accion Microfinance Bank","090160"=>"Addosser Microfinance Bank","347"=>"Aella MFB","120004"=>"Airtel Smartcash PSB","100029"=>"Alternative Bank","090529"=>"Ampersand Microfinance Bank","090287"=>"Asset Matrix Microfinance Bank","090264"=>"Auchi Microfinance Bank","895"=>"Avuenegbe MFB","110072"=>"Bank 78","090136"=>"Baobab Microfinance Bank","348"=>"Bestar MFB","50931"=>"Bowen Microfinance Bank","050006"=>"Branch International Financial Services","983"=>"Bud Infrastructure","956"=>"Capricon Digital","100026"=>"Carbon","748"=>"Cash Connect MFB","090490"=>"Chukwunenye Microfinance Bank","023"=>"Citibank Nigeria Limited","100032"=>"Contec Global Infotech Limited","766"=>"Core Step MFB","346"=>"Creditville MFB","453"=>"Crust MFB","50159"=>"DavoDani MFB","090391"=>"Davodani Microfinance Bank","063"=>"Diamond Bank","090470"=>"Dot MFB","999999"=>"E-Settlement Ltd.","050"=>"Ecobank Nigeria","090097"=>"Ekondo Microfinance Bank","090539"=>"Enrich Microfinance Bank","084"=>"Enterprise Bank","400001"=>"FSDH Merchant Bank","090551"=>"Fairmoney Microfinance Bank","070"=>"Fidelity Bank","608"=>"Finatrust MFB","011"=>"First Bank of Nigeria","214"=>"First City Monument Bank","309"=>"First Monnie Wallet","622"=>"Flutterwave","058"=>"GTBank","000027"=>"Globus Bank","090574"=>"Goldman MFB","090495"=>"Good News Microfinance Bank","090599"=>"Greenacres MFB","090195"=>"Grooming MFB","110059"=>"Habari Pay","090147"=>"Hackman Microfinance Bank","090291"=>"Hala Credit Microfinance Bank","030"=>"Heritage Bank","120002"=>"Hope Payment Service Bank","090118"=>"Ibile Microfinance Bank","090536"=>"Ikoyi Osun MFB","301"=>"Jaiz Bank","090602"=>"Kenechukwu Microfinance Bank","082"=>"Key Stone Bank","899"=>"Kolomoni MFB","321"=>"Konga Pay","090380"=>"Kredi Microfinance Bank","090267"=>"Kuda Microfinance Bank","090177"=>"Lapo Microfinance Bank","397"=>"LeadCity MFB","090420"=>"Letshego Microfinance Bank","000029"=>"Lotus Bank","090171"=>"Mainstreet Microfinance Bank","648"=>"Malachy MFB","090455"=>"Mkobo Microfinance Bank","120003"=>"Momo Payment Service Bank","090405"=>"Moniepoint Microfinance Bank","950"=>"Netapps Technology","090194"=>"Nirsal MFB","090645"=>"Nombank","090345"=>"OAU Microfinance Bank","090295"=>"Omiye MFB","327"=>"Paga","070008"=>"Page Financials","100033"=>"Palmpay","000030"=>"Parallex MF Bank","311"=>"Parkway Projects","329"=>"PayAttitude Online","305"=>"Paycom (Opay)","100039"=>"Paystack Titan","076"=>"Polaris Bank","000031"=>"Premium Trust Bank","090499"=>"Pristine Divitis Microfinance Bank","090503"=>"Projetcs Microfinance Bank","50739"=>"Prospa Capital MFB","101"=>"Providus Bank","090496"=>"Randalpha Microfinance Bank","090198"=>"RenMoney Microfinance Bank","090138"=>"Royal Exchange Microfinance Bank","649"=>"Rubies MFB","090286"=>"Safe Haven MFB","090502"=>"Shalom Microfinance Bank","942"=>"Smart Cash PSB","090325"=>"Sparkle","090436"=>"Spectrum MFB","039"=>"Stanbic IBTC Bank","068"=>"Standard Chartered Bank Nigeria","667"=>"Stellas MFB","232"=>"Sterling Bank Plc","100"=>"SunTrust Bank Nigeria Limited","000026"=>"Taj Bank","000025"=>"Titan Trust Bank","090251"=>"UNN Microfinance Bank","672"=>"Uda MFB","090193"=>"Unical MFB","032"=>"Union Bank of Nigeria","033"=>"United Bank for Africa","215"=>"Unity Bank","566"=>"VFD Microfinance Bank Limited","050020"=>"Vale Finance","035"=>"Wema Bank","148"=>"XPress MTS","738"=>"XPress Payments","391"=>"XPress Wallet","964"=>"Yello Digital Services","792"=>"ZWallet","057"=>"Zenith Bank","090504"=>"Zikora Microfinance Bank","306"=>"eTranzact"];


$paystack = ["120001"=>"9mobile 9Payment Service Bank","404"=>"Abbey Mortgage Bank","51204"=>"Above Only MFB","51312"=>"Abulesoro MFB","044"=>"Access Bank","063"=>"Access Bank (Diamond)","602"=>"Accion Microfinance Bank","50315"=>"Aella MFB","90077"=>"AG Mortgage Bank","50036"=>"Ahmadu Bello University Microfinance Bank","120004"=>"Airtel Smartcash PSB","51336"=>"AKU Microfinance Bank","090561"=>"Akuchukwu Microfinance Bank Limited","090629"=>"Amegy Microfinance Bank","50926"=>"Amju Unique MFB","645"=>"Amucha MFB","645"=>"Amucha Microfinance Bank","50083"=>"Aramoko MFB","401"=>"ASO Savings and Loans","50092"=>"Assets Microfinance Bank","090478"=>"AVUENEGBE MICROFINANCE BANK","51351"=>"AWACASH MICROFINANCE BANK","51337"=>"AZTEC MICROFINANCE BANK LIMITED","51229"=>"Bainescredit MFB","50117"=>"Banc Corp Microfinance Bank","51341"=>"BANKLY MFB","51100"=>"BellBank Microfinance Bank","51267"=>"Benysta Microfinance Bank Limited","50123"=>"Beststar Microfinance Bank","50931"=>"Bowen Microfinance Bank","565"=>"Carbon","51353"=>"Cashbridge Microfinance Bank Limited","865"=>"CASHCONNECT MFB","50823"=>"CEMCS Microfinance Bank","50171"=>"Chanelle Microfinance Bank Limited","312"=>"Chikum Microfinance bank","023"=>"Citibank Nigeria","070027"=>"CITYCODE MORTAGE BANK","50910"=>"Consumer Microfinance Bank","50204"=>"Corestep MFB","559"=>"Coronation Merchant Bank","51297"=>"Crescent MFB","090560"=>"Crust Microfinance Bank","51334"=>"Davenport MICROFINANCE BANK","50162"=>"Dot Microfinance Bank","050"=>"Ecobank Nigeria","50263"=>"Ekimogun MFB","098"=>"Ekondo Microfinance Bank","090678"=>"EXCEL FINANCE BANK","50126"=>"Eyowo","51318"=>"Fairmoney Microfinance Bank","50298"=>"Fedeth MFB","070"=>"Fidelity Bank","51314"=>"Firmus MFB","011"=>"First Bank of Nigeria","214"=>"First City Monument Bank","090164"=>"FIRST ROYAL MICROFINANCE BANK","413"=>"FirstTrust Mortgage Bank Nigeria","501"=>"FSDH Merchant Bank Limited","832"=>"FUTMINNA MICROFINANCE BANK","812"=>"Gateway Mortgage Bank LTD","00103"=>"Globus Bank","090574"=>"Goldman MFB","100022"=>"GoMoney","090664"=>"GOOD SHEPHERD MICROFINANCE BANK","50739"=>"Goodnews Microfinance Bank","562"=>"Greenwich Merchant Bank","51276"=>"GROOMING MICROFINANCE BANK","058"=>"Guaranty Trust Bank","51251"=>"Hackman Microfinance Bank","50383"=>"Hasal Microfinance Bank","120002"=>"HopePSB","51211"=>"IBANK Microfinance Bank","51244"=>"Ibile Microfinance Bank","50439"=>"Ikoyi Osun MFB","50442"=>"Ilaro Poly Microfinance Bank","50453"=>"Imowo MFB","415"=>"IMPERIAL HOMES MORTAGE BANK","50457"=>"Infinity MFB","090701"=>"ISUA MFB","301"=>"Jaiz Bank","50502"=>"Kadpoly MFB","51308"=>"KANOPOLY MFB","082"=>"Keystone Bank","100025"=>"KONGAPAY (Kongapay Technologies Limited)(formerly Zinternet)","50200"=>"Kredi Money MFB LTD","50211"=>"Kuda Bank","90052"=>"Lagos Building Investment Company Plc.","50549"=>"Links MFB","031"=>"Living Trust Mortgage Bank","50491"=>"LOMA MFB","303"=>"Lotus Bank","090171"=>"MAINSTREET MICROFINANCE BANK","50563"=>"Mayfair MFB","50304"=>"Mint MFB","946"=>"Money Master PSB","50515"=>"Moniepoint MFB","120003"=>"MTN Momo PSB","090190"=>"MUTUAL BENEFITS MICROFINANCE BANK","090679"=>"NDCC MICROFINANCE BANK","51361"=>"NET MICROFINANCE BANK","51142"=>"Nigerian Navy Microfinance Bank Limited","561"=>"NOVA BANK","50629"=>"NPF MICROFINANCE BANK","999992"=>"OPay Digital Services Limited (OPay)","107"=>"Optimus Bank Limited","100002"=>"Paga","999991"=>"PalmPay","104"=>"Parallex Bank","311"=>"Parkway - ReadyCash","090680"=>"PATHFINDER MICROFINANCE BANK LIMITED","100039"=>"Paystack-Titan","50743"=>"Peace Microfinance Bank","51226"=>"PECANTRUST MICROFINANCE BANK LIMITED","51146"=>"Personal Trust MFB","50746"=>"Petra Mircofinance Bank Plc","050021"=>"PFI FINANCE COMPANY LIMITED","268"=>"Platinum Mortgage Bank","00716"=>"Pocket App","076"=>"Polaris Bank","50864"=>"Polyunwana MFB","105"=>"PremiumTrust Bank","50739"=>"Prospa Capital Microfinance Bank","050023"=>"PROSPERIS FINANCE LIMITED","101"=>"Providus Bank","51293"=>"QuickFund MFB","502"=>"Rand Merchant Bank","090496"=>"RANDALPHA MICROFINANCE BANK","90067"=>"Refuge Mortgage Bank","50761"=>"REHOBOTH MICROFINANCE BANK","50994"=>"Rephidim Microfinance Bank","51286"=>"Rigo Microfinance Bank Limited","50767"=>"ROCKSHIELD MICROFINANCE BANK","125"=>"Rubies MFB","51113"=>"Safe Haven MFB","951113"=>"Safe Haven Microfinance Bank Limited","40165"=>"SAGE GREY FINANCE LIMITED","50582"=>"Shield MFB","106"=>"Signature Bank Ltd","51062"=>"Solid Allianze MFB","50800"=>"Solid Rock MFB","51310"=>"Sparkle Microfinance Bank","221"=>"Stanbic IBTC Bank","068"=>"Standard Chartered Bank","090162"=>"STANFORD MICROFINANCE BANK","50809"=>"STATESIDE MICROFINANCE BANK","51253"=>"Stellas MFB","232"=>"Sterling Bank","100"=>"Suntrust Bank","50968"=>"Supreme MFB","302"=>"TAJ Bank","51269"=>"Tangerine Money","000304"=>"The Alternative bank","102"=>"Titan Bank","090708"=>"TransPay MFB","50840"=>"U&C Microfinance Bank Ltd (U AND C MFB)","090706"=>"UCEE MFB","51322"=>"Uhuru MFB","50870"=>"Unaab Microfinance Bank Limited","50871"=>"Unical MFB","51316"=>"Unilag Microfinance Bank","032"=>"Union Bank of Nigeria","033"=>"United Bank For Africa","215"=>"Unity Bank","50894"=>"Uzondu Microfinance Bank Awka Anambra State","050020"=>"Vale Finance Limited","566"=>"VFD Microfinance Bank Limited","51355"=>"Waya Microfinance Bank","035"=>"Wema Bank","594"=>"Yes MFB","057"=>"Zenith Bank"];

$array = $paystack;
if(vp_getoption("enable_nomba") == "yes"){
    $array = $nomba;
}
?>
<style>
    .primary-color{
        background-color: <?php echo vp_getoption("msorg_from");?>;
    }
    .text-primary, .primary-text{
        color: <?php echo vp_getoption("msorg_from");?>;
    }
    .primary-border{
        border: 1px solid <?php echo vp_getoption("msorg_from");?>;
    }
</style>


<div class="container position-relative" id="main-page">

    <div id="airtime-page-header" class="row p-4 bg-white">
        <div class="col d-flex flex-row justify-content-start align-items-start">
           <span class="general-text"><a href="#" class="back cursor-pointer text-decoration-none text-black"><i class="fa-solid fa-angle-left me-3 "></i></a>Bank Transfer</span>
        </div>
    </div>


	
<div class="transfer-row container-fluid  ">
    <div class="row hooktop d-none">
        <div class="col primary-color text-white p-3 d-flex justify-content-between">
            <i class="fa-solid fa-caret-left go-back fs-2 "></i>
            <i class="fa-solid fa-clock-rotate-left fs-2 refresh"></i>
        </div>
    </div>
    <div class="row mt-3 d-none">
        <div class="col">
            <!-- alert-->
             <div class="alert alert-info alert-dismissible fade show" role="alert">
                  <strong>Hello!</strong> Welcome to out chatroom where you can buy/sell.
                  
                  <button type="button" class="btn-close d-none" data-bs-dismiss="alert" aria-label="Close"></button>
             </div>
            <!-- end of alert-->
        </div>
    </div>

    <div class="row hookafter p-2 ">
        <div class="col-12 my-2 d-flex justify-content-center align-items-center p-3 shadow rounded border">
            <form action="" class="withdrawalForm py-3">
                    
                <div class="balance">
                    <span class="text-primary rounded primary-border py-2 ps-3 "> <span class="primary-text me-2">Your Balance:</span> <span class="userbalance  p-2 rounded-end text-white fw-bold primary-color d-none"><?php echo intval($bal);?></span><span class="userbalNow p-2 rounded-end text-white fw-bold primary-color"><?php echo number_format($bal);?></span></span>
                </div>
                
                <div class="form-group">
                    <label for="amount">Amount</label>
                    <input type="number" class="form-control" id="amount" placeholder="Enter amount">
                    <small id="amountHelp" class="form-text text-muted">Please enter a valid amount.</small>
                </div>
                <div class="form-group">
                    <label for="accountName">Bank:</label>
                    <select name="bankCode" class="form-control bankCode"  id="bankCode" >
                        <option value=""> Select Bank </option>
                        <?php foreach($array as $value => $key):?>
                                <option value="<?php echo $value;?>"><?php echo $key;?> </option>
                        <?php endforeach;?>

                    </select>
                    <small id="amountHelp" class="form-text text-muted">Select Your Bank</small>
                </div>
                <div class="form-group">
                    <label for="accountNumber">Account Number:</label>
                    <input type="number" class="form-control" id="accountNumber" placeholder="Enter account number">
                    <small id="amountHelp" class="form-text text-muted">Please enter a valid account Number.</small>
                </div>
                <div class="form-group">
                    <label for="accountName">Account Name:</label>
                    <input type="name" class="form-control" id="accountName" placeholder="Enter account name" disabled>
                    <small id="amountHelp" class="form-text text-muted">Wait for around 5seconds after entering your account number.</small>
                </div>


                <button type="button" class="btn primary-color text-white withdrawNow">Transfer</button>


            </form>
        </div>
    </div>
</div>	
		



</div>


<script>


var withdrawUrl = "<?php echo plugins_url('vtupress/transfer.php');?>";

function doAjax(url, data, type, successCallback = defaultSuccessfullMessage){
  
  if(url == ""){
    showToast("URL is not defined","red",2000);
    return;
  }
  else if (!data || typeof data !== 'object') {
    showToast("Data object is not defined","red",2000);
    return;
  }
  else if (type.toLowerCase() != 'post' && type.toLowerCase() != 'get'){
    showToast("Type must be either post or get","red",2000);
    return;
  }

  showToast("Processing","yellow",5000);

  jQuery.ajax({
    url: url,
    data: data,
    dataType: "text",
    "cache": false,
    "async": true,
    type: type.toUpperCase(),
    error: function (jqXHR, exception) {
      var msg = "";
      if (jqXHR.status === 0) {
          msg = "No Connection.\n Verify Network.";
      }   else if (jqXHR.status == 403) {
            msg = "Access Forbidden [403].";
      }  else if (jqXHR.status == 404) {
          msg = "Requested page not found. [404]";
      } else if (jqXHR.status == 500) {
              msg = "Internal Server Error [500].";
      } else if (exception === "parsererror") {
            msg = "Requested JSON parse failed.";
      } else if (exception === "timeout") {
            msg = "Time out error.";
      } else if (exception === "abort") {
            msg = "Ajax request aborted.";
      } else {
          msg = "Uncaught Error.\n" + jqXHR.responseText;
      }
      
      showToast(msg, "red",4000);
      jQuery("button").removeAttr("disable");
      },
      success: function(response) {
        successCallback(response);
      }


  });

}

    jQuery("#amount").on("input", function() {
    var amt = jQuery(this).val();
    var bal = parseInt(jQuery(".userbalance").text());
    
    if (isNaN(amt) || amt <= 0) {
        jQuery(this).val("");
        return;
    }

    else if(amt > bal){
        jQuery(this).val("");
        showToast("Insufficient balance!","red");
        return;
    }
    
});

jQuery("#amount").on("change", function() {
    var amt = jQuery(this).val();
    var bal = parseInt(jQuery(".userbalance").text());
    if(amt < 100){
        jQuery(this).val("");
        showToast("Minimum withdrawal is ₦100!","red");
        return;
    }
    
});


function generateName(response){
   jQuery("#accountName").val(response);
}

function transferResponse(response){

    jQuery(".withdrawNow").removeClass("disabled");

    if(response == "success"){
        showToast("Transfer successful!","green");
        jQuery("#amount").val("");
        jQuery("#accountNumber").val("");
        jQuery("#bankCode").val("");

        setTimeout(function() {
           window.location.href = "?vend=history&for=wallet";
        },1000);
    }
    else if(response == "failed"){
        showToast("Transfer failed!","red");
        setTimeout(function() {
           window.location.href = "?vend=history&for=wallet";
        },1000);
    }
    else if(response == "101"){
        showToast("Error Processing - 101","red");
        setTimeout(function() {
           window.location.href = "?vend=history&for=wallet";
        },1000);
    }
    else if(response == "102"){
        showToast("Error Processing - 102","red");
    }
    else{
        showToast(response,"red");
    }
}

var userId = "123456"; // Replace with user ID
var userCode = "";


jQuery("#accountNumber").on("input", function() {
    var amt = jQuery("#amount").val();
    var acct = jQuery(this).val();
    var bank = jQuery("#bankCode").val();
    

    jQuery("#accountName").val("");
    if(acct.length != 10){
        //showToast("Invalid account number!","red");
        jQuery("#accountNumber").focus();
        return;
    }
    else if(bank == ""){
        showToast("Invalid bank!","red");
        jQuery("#bankCode").select();
        return;
    }

    setTimeout(function() {
        var obj = {
            "id":userId,
            "code":userCode,
            "account_number": acct,
            "bank_code": bank,
            "amount": amt,
            "account_name": "Akor Victor",
            "get_details": "yes",
            "action": "details"
        };

        console.log(obj);
        console.log(withdrawUrl);
        doAjax(withdrawUrl,obj,'post',generateName);
    },500);
});

jQuery(".withdrawNow:not('.disabled')").click(function() {
    var amt = jQuery("#amount").val();
    var bal = parseInt(jQuery(".userbalance").text());
    var acct = jQuery("#accountNumber").val();
    var accountName = jQuery("#accountName").val();
    var bank = jQuery("#bankCode").val();
    var bankCode = jQuery("#bankCode").val();
    
    if(isNaN(amt) || amt <= 0){
        showToast("Invalid amount!","red");
        jQuery("#amount").focus();
        return;
    }
    else if(amt > bal){
        showToast("Insufficient balance!","red");
        return;
    }
    else if(acct.length != 10){
        showToast("Invalid account number!","red");
        jQuery("#accountNumber").focus();
        return;

    }
    else if(accountName.length < 3 || accountName == ""){
        showToast("Invalid account holder name!","red");
        jQuery("#accountName").focus();
        return;
    }
    else if( bankCode == ""){
        showToast("Invalid bank!","red");
        jQuery("#accountName").focus();
        return;
    }
    

    //do ajax

    var obj = {
        "id":userId,
        "code":userCode,
        "account_number": acct,
        "bank_code": bank,
        "amount": amt,
        "account_name": "Akor Victor",
        "action": "transfer"
    };

    console.log(obj);
    console.log(withdrawUrl);
    jQuery(this).addClass("disabled");
    doAjax(withdrawUrl,obj,'post',transferResponse);
    
});
</script>
